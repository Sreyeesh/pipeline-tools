services:
  pipeline-tools:
    image: pipeline-tools:latest
    build: .
    working_dir: /app
    volumes:
      - ${PROJECTS_ROOT:-/mnt/c/Projects}:/mnt/c/Projects
      - ${DB_VOLUME:-pipeline-tools-db}:/root/.pipeline_tools
    entrypoint: ["python", "-m", "pipeline_tools.cli"]
    command: ["--list"]

  pipeline-tools-test:
    image: pipeline-tools:builder
    build:
      context: .
      target: builder
    working_dir: /app
    volumes:
      - ./:/app
    entrypoint: ["/bin/sh", "-c"]
    command: ["pytest"]

  pipeline-tools-shell:
    image: pipeline-tools:latest
    build: .
    working_dir: /app
    volumes:
      - ${PROJECTS_ROOT:-/mnt/c/Projects}:/mnt/c/Projects
      - ${DB_VOLUME:-pipeline-tools-db}:/root/.pipeline_tools
      - ./:/app
    entrypoint: ["/bin/sh"]

volumes:
  pipeline-tools-db:
    name: ${DB_VOLUME:-pipeline-tools-db}
